Appcelerator.Widget.Statemachine={getName:function(){return"appcelerator statemachine"},getDescription:function(){return"statemachine widget"},getVersion:function(){return"__VERSION__"},getSpecVersion:function(){return 1},getAuthor:function(){return"Jeff Haynie"},getModuleURL:function(){return"http://www.appcelerator.org"},isWidget:function(){return true},getWidgetName:function(){return"app:statemachine"},getAttributes:function(){return[{name:"initial",optional:true,description:"Initial state of the state machine."},{name:"id",optional:false,description:"Id of the statemachine, which can be used as a web expression condition"}]},getChildNodes:function(){return[{name:"state",attributes:[{name:"name",description:"state name"},{name:"if",description:"state condition"}]}]},buildWidget:function(E,K){var G=K.initial;var B=false;var C=K.id;var L=[];if(Appcelerator.Browser.isIE){var J=E.innerHTML;J=J.replace(/<STATE/g,"<APP:STATE");J=J.replace(/\/STATE>/g,"/APP:STATE>");E.innerHTML=J}for(var I=0,F=E.childNodes.length;I<F;I++){var D=E.childNodes[I];if(D.nodeType==1&&D.nodeName.toLowerCase()=="state"){var A=D.getAttribute("name");var H=D.getAttribute("if");if(G&&G==A){B=true}L.push({name:A,cond:H})}}if(G){if(!B){throw"invalid initial state - couldn't find state: "+G+" for "+C}}K.states=L;return{position:Appcelerator.Compiler.POSITION_REPLACE,presentation:"",compile:true}},compileWidget:function(M){var C=M.id;var D=$(C);var G=M.initial;D.value=G||"";var N=M.states;var L=[];for(var K=0,F=N.length;K<F;K++){var B=N[K];var A=B.name;var J=B.cond;Appcelerator.Compiler.StateMachine.addState(C,A,null);L.push(Appcelerator.Compiler.StateMachine.compileStateCondition(A,J))}var I=Appcelerator.Compiler.StateMachine.buildConditions(L);if(G){D.value=G;Appcelerator.Compiler.StateMachine.resetOnStateListeners();if(Appcelerator.Compiler.StateMachine.initialStateLoaders){Appcelerator.Compiler.StateMachine.initialStateLoaders.push([C,G])}}var E=null;$MQL(I.types,function(Q,S,P,V){try{if(!E){E=I.code.toFunction();I=null}var O=V+":"+Q;var U={messagetype:O,type:Q,datatype:P,direction:V,data:S};var R=E.call(U);if(R){Appcelerator.Compiler.StateMachine.fireStateMachineChange(C,R,true)}else{R=Appcelerator.Compiler.StateMachine.getActiveState(C);if(R){Appcelerator.Compiler.StateMachine.fireStateMachineChange(C,R,null)}}}catch(T){$E("Error processing message: "+V+":"+Q+" - "+Object.getExceptionDetail(T))}},D.scope,D);var H=function(P,Q,O){if(O){D.value=Q}};Appcelerator.Compiler.StateMachine.registerStateListener(C,H);Appcelerator.Compiler.StateMachine.fireOnStateListeners();Appcelerator.Compiler.addTrash(D,function(){if(H){Appcelerator.Compiler.StateMachine.unregisterStateListener(H);H=null}Appcelerator.Util.ServiceBroker.removeListener(listener)})}};Appcelerator.Widget.register("app:statemachine",Appcelerator.Widget.Statemachine);