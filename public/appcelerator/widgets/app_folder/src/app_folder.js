Appcelerator.Widget.Folder={modulePath:null,setPath:function(A){this.modulePath=A},getName:function(){return"appcelerator folder"},getDescription:function(){return"folder widget"},getVersion:function(){return"__VERSION__"},getSpecVersion:function(){return 1},getAuthor:function(){return"Jeff Haynie"},getModuleURL:function(){return"http://www.appcelerator.org"},isWidget:function(){return true},getWidgetName:function(){return"app:folder"},getAttributes:function(){return[]},getActions:function(){return["openAll","closeAll","selectItem","open","close"]},openAll:function(G,A,E,D,B){var C=$(G).childNodes;for(var F=0;F<C.length;F++){C[F]._onopened()}},closeAll:function(G,A,E,D,B){var C=$(G).childNodes;for(var F=0;F<C.length;F++){C[F]._onclosed()}},close:function(H,A,G,E,C,F){var D=Object.getNestedProperty(F[0],"value");D=parseInt(D)*2;var B=H+"_folder_"+D;$(B)._onclosed()},open:function(H,A,G,E,C,F){var D=Object.getNestedProperty(F[0],"value");D=parseInt(D)*2;var B=H+"_folder_"+D;$(B)._onopened()},selectItem:function(C,A,G,K,I,H){var J;var F;for(var E=0;E<H.length;E++){if(Object.getNestedProperty(H[E],"key")=="folder"){J=Object.getNestedProperty(H[E],"value")}else{if(Object.getNestedProperty(H[E],"key")=="item"){F=Object.getNestedProperty(H[E],"value")}}}J=parseInt(J)*2;var B=C+"_folder_"+J;var D=C+"_folder_"+J+"_child_"+F;$(B)._onopened();$(D)._onopened()},getChildNodes:function(){var A=Appcelerator.Types;var B=[{name:"open",type:A.messageReceive,description:"A condition which will trigger the item to be opened"},{name:"onopen",type:A.messageSend,description:""},{name:"onclose",type:A.messageSend,description:""},{name:"opened_icon",optional:true,type:A.pathOrUrl},{name:"closed_icon",optional:true,type:A.pathOrUrl}];return[{name:"folder",attributes:B,childNodes:[{name:"item",attributes:B}]}]},compileWidget:function(D){var C=function(F){D.itemnodes.each(function(G){if(F!=G&&$(G).opened){$(G)._onclosed()}})};var B=function(G,F){$A($(G+"_children").childNodes).findAll(function(H){return H.nodeType==1}).each(function(H){if(H.id!=F){$(H.id)._onclosed()}})};var A=D.nodes;for(var E=0;E<A.length;E++){(function(){var G=A[E];if(G.nodeType==1&&G.nodeName.toLowerCase()=="folder"){var H=G._parentid;var F=$(H);G._children.each(function(O,I){var L=O._childid;var K=O.getAttribute("open");var N=O.getAttribute("onopen");var M=O.getAttribute("onclose");if(N){N=Appcelerator.Compiler.makeAction(L,N)}if(M){M=Appcelerator.Compiler.makeAction(L,M)}if(K){var J="$('"+H+"')._onopened(); $('"+L+"')._onopened();";Appcelerator.Compiler.handleCondition(O,K,"function["+J+"]",null,0,null)}$(L)._onopened=function(){if(!$(L).opened){C(L);Element.removeClassName(L+"_item","closed");Element.addClassName(L+"_item","opened");$(L).opened=true;Element.hide(L+"_closed");Element.show(L+"_opened");B(H,L);if(N){N()}}};$(L)._onclosed=function(){if($(L).opened){$(L).opened=false;Element.removeClassName(L+"_item","open");Element.addClassName(L+"_item","closed");Element.hide(L+"_opened");Element.show(L+"_closed");if(M){M()}}};$(L+"_closed").onclick=function(){$(L)._onopened()};$(L+"_opened").onclick=function(){$(L)._onclosed()};$(L).onclick=function(P){P=Event.getEvent(P);P.stop();if($(L).opened){$(L)._onclosed()}else{$(L)._onopened()}};$(L)._onclosed()});$(H+"_closed").onclick=function(){F.opened=true;Element.hide(H+"_closed");Element.show(H+"_opened");Element.toggle(H+"_children")};$(H+"_opened").onclick=function(){F.opened=false;Element.hide(H+"_opened");Element.show(H+"_closed");Element.toggle(H+"_children")};F._onopened=function(){F.opened=true;Element.hide(H+"_closed");Element.show(H+"_opened");Element.show(H+"_children");B(H,null)};F._onclosed=function(){F.opened=false;Element.show(H+"_closed");Element.hide(H+"_opened");Element.hide(H+"_children");B(H,null)};F.onclick=function(I){I=Event.getEvent(I);I.stop();if(!F.opened){F._onopened()}else{F._onclosed()}}}})()}},buildWidget:function(G,L){var H="";var K=0;var C=G.id;var B=[];if(Appcelerator.Browser.isIE){var J=G.innerHTML;J=J.replace(/<FOLDER/g,"<APP:FOLDER").replace(/\/FOLDER>/g,"/APP:FOLDER>");J=J.replace(/<ITEM/g,"<APP:ITEM").replace(/\/ITEM>/g,"/APP:ITEM>");G.innerHTML=J}for(var I=0;I<G.childNodes.length;I++){var E=G.childNodes[I];if(E.nodeType==1&&E.nodeName.toLowerCase()=="folder"){var A=E.getAttribute("opened_icon")||Appcelerator.Widget.Folder.modulePath+"images/folder_opened.png";var M=E.getAttribute("closed_icon")||Appcelerator.Widget.Folder.modulePath+"images/folder_closed.png";var F=C+"_folder_"+(K++);E._parentid=F;H+='<div id="'+F+'">';H+='<div class="folder" id="'+F+'_folder"><img class="folder_image" src="'+M+'" id="'+F+'_closed"/>';H+='<img class="folder_image" src="'+A+'" id="'+F+'_opened" style="display:none"/>';H+='<span class="folder_name" id="'+F+'_name">'+E.getAttribute("name")+"</span></div>";H+='<div class="folder_children" id="'+F+'_children" style="display:none">';var D=$A(E.childNodes).findAll(function(O){return O.nodeType==1&&O.nodeName.toLowerCase()=="item"});E._children=D;var N="";D.each(function(U,P){var O=U.getAttribute("opened_icon")||Appcelerator.Widget.Folder.modulePath+"images/item_opened.png";var Q=U.getAttribute("closed_icon")||Appcelerator.Widget.Folder.modulePath+"images/item_closed.png";var R=F+"_child_"+P;U._childid=R;H+='<div id="'+R+'">';H+='<div id="'+R+'_item" class="item"><img class="item_image" src="'+Q+'" id="'+R+'_closed"/>';H+='<img class="item_image" src="'+O+'" id="'+R+'_opened" style="display:none"/>';H+='<span class="item_name" id="'+R+'_name">'+Appcelerator.Compiler.getHtml(U,true)+"</span>";H+="</div></div>";var T=U.getAttribute("onopen");var S=U.getAttribute("onclose");if(T){T=Appcelerator.Compiler.makeAction(R,T)+";"}if(S){S=Appcelerator.Compiler.makeAction(R,S)+";"}B.push(R)});H+="</div></div>";K++}}L.nodes=G.childNodes;L.itemnodes=B;return{position:Appcelerator.Compiler.POSITION_REPLACE,presentation:H,compile:true}}};Appcelerator.Core.loadModuleCSS("app:folder","folder.css");Appcelerator.Widget.register("app:folder",Appcelerator.Widget.Folder);